{"id":"jvwb","dependencies":[{"name":"C:\\Users\\benne\\np\\nengi-2d-basic\\package.json","includedInParent":true,"mtime":1557038832290},{"name":"C:\\Users\\benne\\np\\nengi-2d-basic\\node_modules\\nengi\\package.json","includedInParent":true,"mtime":1556703465689},{"name":"../snapshot/writer/createCommandBuffer","loc":{"line":1,"column":32},"parent":"C:\\Users\\benne\\np\\nengi-2d-basic\\node_modules\\nengi\\core\\client\\Outbound.js","resolved":"C:\\Users\\benne\\np\\nengi-2d-basic\\node_modules\\nengi\\core\\snapshot\\writer\\createCommandBuffer.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=t(require(\"../snapshot/writer/createCommandBuffer\"));function t(e){return e&&e.__esModule?e:{default:e}}class s{constructor(e,t,s){this.config=s,this.protocols=e,this.websocket=t,this.unconfirmedCommands=new Map,this.sendQueue={},this.clientTick=0,this.confirmedTick=-1,this.lastSentTick=-1}update(){for(var e=this.lastSentTick;e<this.clientTick;e++)this.sendCommands(e),this.lastSentTick=e;this.clientTick++}addCommand(e){var t=this.clientTick;void 0===this.sendQueue[t]&&(this.sendQueue[t]=[]),this.unconfirmedCommands.has(t)||this.unconfirmedCommands.set(t,[]),e[this.config.TYPE_PROPERTY_NAME]=this.protocols.getIndex(e.protocol),this.sendQueue[t].push(e),this.unconfirmedCommands.get(t).push(e)}sendCommands(t){if(this.websocket&&1===this.websocket.readyState){var s=this.sendQueue[t];s||(s=[]),this.websocket.send((0,e.default)(t,s).byteArray),delete this.sendQueue[t]}}confirmCommands(e){this.unconfirmedCommands.forEach((t,s)=>{s<=e&&this.unconfirmedCommands.delete(s)}),this.confirmedTick=e}getUnconfirmedCommands(){return this.unconfirmedCommands}}var i=s;exports.default=i;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":0}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":13}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":20}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":35}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":43}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":56}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":57}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":64}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":68}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":76}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":89}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":150}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":159}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":161}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":164}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":171}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":174}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":176}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":187}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":189}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":190}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":198}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":3,"column":0},"generated":{"line":1,"column":201}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":3,"column":6},"generated":{"line":1,"column":207}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"constructor","original":{"line":4,"column":4},"generated":{"line":1,"column":209}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocols","original":{"line":4,"column":16},"generated":{"line":1,"column":221}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":4,"column":27},"generated":{"line":1,"column":223}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"config","original":{"line":4,"column":38},"generated":{"line":1,"column":225}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"config","original":{"line":5,"column":13},"generated":{"line":1,"column":228}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"config","original":{"line":5,"column":13},"generated":{"line":1,"column":233}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"config","original":{"line":5,"column":22},"generated":{"line":1,"column":240}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocols","original":{"line":6,"column":13},"generated":{"line":1,"column":242}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocols","original":{"line":6,"column":13},"generated":{"line":1,"column":247}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocols","original":{"line":6,"column":25},"generated":{"line":1,"column":257}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":7,"column":13},"generated":{"line":1,"column":259}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":7,"column":13},"generated":{"line":1,"column":264}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":7,"column":25},"generated":{"line":1,"column":274}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":8,"column":13},"generated":{"line":1,"column":276}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":8,"column":13},"generated":{"line":1,"column":281}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":8,"column":35},"generated":{"line":1,"column":301}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Map","original":{"line":8,"column":39},"generated":{"line":1,"column":305}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":9,"column":13},"generated":{"line":1,"column":309}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":9,"column":13},"generated":{"line":1,"column":314}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":9,"column":25},"generated":{"line":1,"column":324}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":10,"column":13},"generated":{"line":1,"column":327}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":10,"column":13},"generated":{"line":1,"column":332}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":10,"column":26},"generated":{"line":1,"column":343}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"confirmedTick","original":{"line":11,"column":13},"generated":{"line":1,"column":345}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"confirmedTick","original":{"line":11,"column":13},"generated":{"line":1,"column":350}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":11,"column":30},"generated":{"line":1,"column":365}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"lastSentTick","original":{"line":12,"column":13},"generated":{"line":1,"column":367}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"lastSentTick","original":{"line":12,"column":13},"generated":{"line":1,"column":372}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":12,"column":29},"generated":{"line":1,"column":386}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"update","original":{"line":15,"column":4},"generated":{"line":1,"column":388}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":16,"column":13},"generated":{"line":1,"column":397}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":16,"column":13},"generated":{"line":1,"column":401}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"i","original":{"line":16,"column":17},"generated":{"line":1,"column":405}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":16,"column":21},"generated":{"line":1,"column":407}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"lastSentTick","original":{"line":16,"column":26},"generated":{"line":1,"column":412}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"i","original":{"line":16,"column":40},"generated":{"line":1,"column":425}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":16,"column":44},"generated":{"line":1,"column":427}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":16,"column":49},"generated":{"line":1,"column":432}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"i","original":{"line":16,"column":61},"generated":{"line":1,"column":443}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendCommands","original":{"line":17,"column":17},"generated":{"line":1,"column":447}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendCommands","original":{"line":17,"column":17},"generated":{"line":1,"column":452}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"i","original":{"line":17,"column":30},"generated":{"line":1,"column":465}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"lastSentTick","original":{"line":18,"column":17},"generated":{"line":1,"column":468}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"lastSentTick","original":{"line":18,"column":17},"generated":{"line":1,"column":473}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"i","original":{"line":18,"column":32},"generated":{"line":1,"column":486}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":20,"column":13},"generated":{"line":1,"column":488}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":20,"column":13},"generated":{"line":1,"column":493}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"addCommand","original":{"line":26,"column":4},"generated":{"line":1,"column":506}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":26,"column":15},"generated":{"line":1,"column":517}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":27,"column":12},"generated":{"line":1,"column":520}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":27,"column":12},"generated":{"line":1,"column":524}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":27,"column":19},"generated":{"line":1,"column":526}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"clientTick","original":{"line":27,"column":24},"generated":{"line":1,"column":531}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":29,"column":44},"generated":{"line":1,"column":547}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":29,"column":19},"generated":{"line":1,"column":551}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":29,"column":24},"generated":{"line":1,"column":556}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":29,"column":34},"generated":{"line":1,"column":566}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":30,"column":17},"generated":{"line":1,"column":571}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":30,"column":17},"generated":{"line":1,"column":576}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":30,"column":27},"generated":{"line":1,"column":586}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":30,"column":35},"generated":{"line":1,"column":589}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":32,"column":13},"generated":{"line":1,"column":593}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":32,"column":18},"generated":{"line":1,"column":598}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"has","original":{"line":32,"column":38},"generated":{"line":1,"column":618}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":32,"column":42},"generated":{"line":1,"column":622}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":33,"column":17},"generated":{"line":1,"column":626}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":33,"column":17},"generated":{"line":1,"column":631}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"set","original":{"line":33,"column":37},"generated":{"line":1,"column":651}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":33,"column":41},"generated":{"line":1,"column":655}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":33,"column":47},"generated":{"line":1,"column":657}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":35,"column":8},"generated":{"line":1,"column":661}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":35,"column":16},"generated":{"line":1,"column":663}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"config","original":{"line":35,"column":21},"generated":{"line":1,"column":668}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"TYPE_PROPERTY_NAME","original":{"line":35,"column":28},"generated":{"line":1,"column":675}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":35,"column":50},"generated":{"line":1,"column":695}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocols","original":{"line":35,"column":55},"generated":{"line":1,"column":700}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"getIndex","original":{"line":35,"column":65},"generated":{"line":1,"column":710}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":35,"column":74},"generated":{"line":1,"column":719}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"protocol","original":{"line":35,"column":82},"generated":{"line":1,"column":721}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":36,"column":13},"generated":{"line":1,"column":731}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":36,"column":13},"generated":{"line":1,"column":736}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":36,"column":23},"generated":{"line":1,"column":746}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"push","original":{"line":36,"column":29},"generated":{"line":1,"column":749}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":36,"column":34},"generated":{"line":1,"column":754}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":37,"column":13},"generated":{"line":1,"column":757}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":37,"column":13},"generated":{"line":1,"column":762}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"get","original":{"line":37,"column":33},"generated":{"line":1,"column":782}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":37,"column":37},"generated":{"line":1,"column":786}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"push","original":{"line":37,"column":43},"generated":{"line":1,"column":789}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":37,"column":48},"generated":{"line":1,"column":794}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendCommands","original":{"line":40,"column":4},"generated":{"line":1,"column":797}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":40,"column":17},"generated":{"line":1,"column":810}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":41,"column":12},"generated":{"line":1,"column":813}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":41,"column":12},"generated":{"line":1,"column":816}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":41,"column":17},"generated":{"line":1,"column":821}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":41,"column":60},"generated":{"line":1,"column":832}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":41,"column":30},"generated":{"line":1,"column":836}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":41,"column":35},"generated":{"line":1,"column":841}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"readyState","original":{"line":41,"column":45},"generated":{"line":1,"column":851}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":41,"column":63},"generated":{"line":1,"column":862}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"commands","original":{"line":43,"column":16},"generated":{"line":1,"column":863}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"commands","original":{"line":43,"column":16},"generated":{"line":1,"column":867}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":43,"column":27},"generated":{"line":1,"column":869}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":43,"column":32},"generated":{"line":1,"column":874}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":43,"column":42},"generated":{"line":1,"column":884}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"commands","original":{"line":44,"column":17},"generated":{"line":1,"column":887}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"commands","original":{"line":45,"column":16},"generated":{"line":1,"column":891}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":45,"column":27},"generated":{"line":1,"column":893}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":47,"column":17},"generated":{"line":1,"column":897}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"websocket","original":{"line":47,"column":17},"generated":{"line":1,"column":902}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"send","original":{"line":47,"column":27},"generated":{"line":1,"column":912}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":47,"column":32},"generated":{"line":1,"column":918}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":47,"column":52},"generated":{"line":1,"column":920}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":47,"column":52},"generated":{"line":1,"column":922}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":47,"column":52},"generated":{"line":1,"column":931}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"commands","original":{"line":47,"column":58},"generated":{"line":1,"column":933}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"byteArray","original":{"line":47,"column":68},"generated":{"line":1,"column":936}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":48,"column":19},"generated":{"line":1,"column":954}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"sendQueue","original":{"line":48,"column":24},"generated":{"line":1,"column":959}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":48,"column":34},"generated":{"line":1,"column":969}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"confirmCommands","original":{"line":52,"column":4},"generated":{"line":1,"column":973}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":52,"column":20},"generated":{"line":1,"column":989}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":53,"column":13},"generated":{"line":1,"column":992}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":53,"column":13},"generated":{"line":1,"column":997}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"forEach","original":{"line":53,"column":33},"generated":{"line":1,"column":1017}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":53,"column":41},"generated":{"line":1,"column":1025}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"command","original":{"line":53,"column":42},"generated":{"line":1,"column":1026}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"key","original":{"line":53,"column":51},"generated":{"line":1,"column":1028}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"key","original":{"line":54,"column":16},"generated":{"line":1,"column":1033}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":54,"column":23},"generated":{"line":1,"column":1036}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":55,"column":21},"generated":{"line":1,"column":1039}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":55,"column":21},"generated":{"line":1,"column":1044}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"delete","original":{"line":55,"column":41},"generated":{"line":1,"column":1064}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"key","original":{"line":55,"column":48},"generated":{"line":1,"column":1071}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"confirmedTick","original":{"line":58,"column":13},"generated":{"line":1,"column":1076}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"confirmedTick","original":{"line":58,"column":13},"generated":{"line":1,"column":1081}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"tick","original":{"line":58,"column":29},"generated":{"line":1,"column":1095}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"getUnconfirmedCommands","original":{"line":61,"column":4},"generated":{"line":1,"column":1097}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":62,"column":15},"generated":{"line":1,"column":1122}},{"source":"../node_modules/nengi/core/client/Outbound.js","original":{"line":62,"column":15},"generated":{"line":1,"column":1129}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"unconfirmedCommands","original":{"line":62,"column":20},"generated":{"line":1,"column":1134}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1155}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1159}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1161}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1163}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1171}},{"source":"../node_modules/nengi/core/client/Outbound.js","name":"Outbound","original":{"line":66,"column":15},"generated":{"line":1,"column":1179}}],"sources":{"../node_modules/nengi/core/client/Outbound.js":"import createCommandBuffer from '../snapshot/writer/createCommandBuffer';\r\n\r\nclass Outbound {\r\n    constructor(protocols, websocket, config) {\r\n        this.config = config\r\n        this.protocols = protocols\r\n        this.websocket = websocket\r\n        this.unconfirmedCommands = new Map()\r\n        this.sendQueue = {}\r\n        this.clientTick = 0\r\n        this.confirmedTick = -1\r\n        this.lastSentTick = -1\r\n    }\r\n\r\n    update() {\r\n        for (var i = this.lastSentTick; i < this.clientTick; i++) {    \r\n            this.sendCommands(i)\r\n            this.lastSentTick = i\r\n        }\r\n        this.clientTick++\r\n\r\n        //console.log('sq', this.sendQueue)\r\n        //console.log('unconfirmed', this.unconfirmedCommands)\r\n    }\r\n\r\n    addCommand(command) {\r\n        var tick = this.clientTick\r\n        //command.tick = tick\r\n        if (typeof this.sendQueue[tick] === 'undefined') {\r\n            this.sendQueue[tick] = []        \r\n        }\r\n        if (!this.unconfirmedCommands.has(tick)) {\r\n            this.unconfirmedCommands.set(tick, [])\r\n        }\r\n        command[this.config.TYPE_PROPERTY_NAME] = this.protocols.getIndex(command.protocol)\r\n        this.sendQueue[tick].push(command)\r\n        this.unconfirmedCommands.get(tick).push(command)\r\n    }\r\n\r\n    sendCommands(tick) {\r\n        if (this.websocket && this.websocket.readyState === 1) {\r\n            \r\n            var commands = this.sendQueue[tick]\r\n            if (!commands) {\r\n                commands = []\r\n            }\r\n            this.websocket.send(createCommandBuffer(tick, commands).byteArray)\r\n            delete this.sendQueue[tick]\r\n        }\r\n    }\r\n\r\n    confirmCommands(tick){\r\n        this.unconfirmedCommands.forEach((command, key) => {\r\n            if (key <= tick) {\r\n                this.unconfirmedCommands.delete(key)\r\n            }\r\n        })\r\n        this.confirmedTick = tick\r\n    }\r\n\r\n    getUnconfirmedCommands() {\r\n        return this.unconfirmedCommands\r\n    }\r\n}\r\n\r\nexport default Outbound;"},"lineCount":null}},"error":null,"hash":"6164d52f589542a8052e88380bf932f0","cacheData":{"env":{}}}